<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>AMBaTuBes Dashboard Dosen</title>
    <link rel="stylesheet" th:href="@{/css/dosenHome.css}"> 
    <script type="text/javascript" th:src="@{/js/dosenHome.js}" defer></script>
</head>
<body>
    <header class="top-navbar">
        <div class="header-content">
            <div class="brand">
                <span class="logo-text">AMBaTuBes</span>
                <span class="separator">|</span>
                <nav class="breadcrumb">
                    <a class="current" th:href="@{/dosen/home}">Dashboard</a>
                </nav>
            </div>
            <div class="user-controls">
                <div class="user-initials" th:text="${#strings.substring(dosen.nama, 0, 2).toUpperCase()}">PP</div>
                <button class="logout-btn" onclick="location.href='/logout'">
                    <img th:src="@{/icons/exit.png}" alt="Logout" class="icon-img">
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Form untuk search dengan GET method -->
        <form th:action="@{/dosen/home}" method="get" id="searchForm">
            <div class="controls">
                <button type="button" class="filter-btn" id="filterBtn">
                    <span><img id="filterIcon" th:src="@{/icons/filter.png}"></span>
                    <span>Filter</span>
                </button>
                <div class="search-bar">
                    <button type="submit" class="search-btn" id="searchButton">
                        <img id="searchIcon" th:src="@{/icons/searchGlass.png}">
                    </button>
                    <input type="text" name="search" th:value="${searchQuery}" 
                           placeholder="Cari kelas berdasarkan nama kelas atau mata kuliah..." 
                           id="searchInput">
                </div>
            </div>

            <!-- Filter Panel -->
            <div class="filter-panel" id="filterPanel">
                <div class="filter-options">
                    <label><input type="checkbox" id="inProgress" name="inProgress" th:checked="${inProgressFilter}"> In-Progress</label>
                    <label><input type="checkbox" id="past" name="past" th:checked="${pastFilter}"> Past</label>
                </div>
                
                <!-- Semester Select -->
                <div th:if="${!semesterList.isEmpty()}">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">Semester:</label>
                    <select id="semesterSelect" name="semester" class="form-select">
                        <option value="">Semua Semester</option>
                        <option th:each="sem : ${semesterList}" 
                                th:value="${sem}"
                                th:text="${sem}"
                                th:selected="${semesterFilter == sem}">
                        </option>
                    </select>
                </div>
                
                <!-- Filter Buttons -->
                <div class="filter-buttons" style="margin-top: 20px; display: flex; gap: 10px;">
                    <button type="submit" class="apply-btn">Terapkan Filter</button>
                    <button type="button" id="clearFilter" class="clear-btn">Reset</button>
                </div>
            </div>
        </form>

        <!-- Hasil Kelas -->
        <div class="class-grid">
            <!-- DATA DINAMIS DARI DATABASE -->
            <div th:each="kelas : ${kelasList}" 
                 class="class-card clickable-card"
                 th:data-id-kelas="${kelas.idKelas}"
                 th:onclick="|redirectToTubes(${kelas.idKelas})|">
                <div class="class-header">
                    
                </div>
                <div class="class-details">
                    <h3 th:text="${kelas.mataKuliah?.namaMk ?: 'Mata Kuliah'}">Mata Kuliah</h3>
                    <p th:text="'Kelas ' + ${kelas.namaKelas}">Kelas</p>
                    <p th:text="${kelas.semester}">Semester</p>
                    <p th:text="${dosen.nama}">Dosen Pengajar</p>
                </div>
            </div>
            
            <!-- JIKA TIDAK ADA DATA -->
            <div th:if="${kelasList == null or kelasList.empty}" class="empty-state">
                <h3>Tidak ada kelas yang diajar</h3>
                <p th:if="${searchQuery != null}">
                    Tidak ditemukan kelas dengan kata kunci "<span th:text="${searchQuery}"></span>"
                </p>
                <p th:unless="${searchQuery != null}">
                    Silakan hubungi admin untuk ditambahkan ke kelas pengajaran
                </p>
            </div>
        </div>
    </main>

    <script>
        // Fungsi untuk redirect ke halaman tubes
        function redirectToTubes(kelasId) {
            if (kelasId) {
                window.location.href = '/dosen/tubes?kelasId=' + kelasId;
            }
        }
        
        // Fungsi untuk edit class
        function editClass(kelasId) {
            if (confirm('Apakah Anda ingin mengedit kelas ini?')) {
                console.log('Edit kelas dengan ID:', kelasId);
                // window.location.href = '/dosen/edit-kelas?id=' + kelasId;
            }
        }
        
        // Fungsi untuk delete class
        function deleteClass(kelasId) {
            if (confirm('Apakah Anda yakin ingin menghapus kelas ini?')) {
                console.log('Hapus kelas dengan ID:', kelasId);
                // Implementasi delete logic di sini
            }
        }
    </script>
</body>
</html>